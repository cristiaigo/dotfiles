#!/usr/bin/env bash
set -euo pipefail
THEMES_DIR="$HOME/.config/waybar/temas"
SCRIPTS_DIR="$HOME/.config/hypr/scripts"
ROFI_THEME="$SCRIPTS_DIR/rofi/waybar-switcher.rasi"

ensure(){
  [[ -x "$SCRIPTS_DIR/switch-waybar-theme" ]] || { echo "Falta switch-waybar-theme"; exit 1; }
  command -v rofi >/dev/null || { echo "Rofi no está"; exit 1; }
}

# construye entradas desde carpetas (ordenadas) — SOLO TEXTO
items(){
  find "$THEMES_DIR" -mindepth 1 -maxdepth 1 -type d -printf '%f\n' | sort
}

# mismo orden que items(): devuelve el nombre por índice
slug(){
  mapfile -t THEMES < <(find "$THEMES_DIR" -mindepth 1 -maxdepth 1 -type d -printf '%f\n' | sort)
  echo "${THEMES[$1]}"
}

pick(){
  items | rofi -dmenu -i -format i \
    -p "Waybar" -theme "$ROFI_THEME" \
    -theme-str '* { font: "JetBrainsMono Nerd Font 15"; }
                window { width: 980; border-radius: 22px; }
                listview { lines: 10; line-margin: 8px; }
                element { padding: 12px 18px; }'
}

main(){
  ensure
  flags=(); while [[ "${1-}" =~ ^- ]]; do flags+=("$1"); shift; done
  idx="$(pick || true)"; [[ -z "${idx:-}" || "$idx" -lt 0 ]] && exit 0
  exec "$SCRIPTS_DIR/switch-waybar-theme" "${flags[@]}" "$(slug "$idx")"
}
main "$@"
